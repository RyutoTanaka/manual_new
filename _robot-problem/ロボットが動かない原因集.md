---
layout: manual
title: ロボットが動かない原因集
category: robot-problem
---

# ロボットが動かない原因集

大会中や練習中、デバッグ中にモーターが動かなくなったときの原因をまとめました。
ハード班用です。

## ロボットの状態の把握に役立つもの
### ロボットの音

- "ピピッ"：AI-serverとの通信が始まった音
- "ピッピー"：AIとの通信が始まった音
- "ピピピ↑" : spi通信が始まった音（jetsonのプログラムが動き出したとき）
- "ピピピ↓" : spi通信が終わった音（jetsonのプログラムが泊まったとき）
- "ピピ" : 起動音（基盤に通電したときになる）
- "ピーポー(ウルトラマン)" : バッテリー電圧が低いときになります。

### LED
- phoenix基盤のLEDが回転しているときは、モーター制御を行っています。
- エンコーダー基盤のLEDが点灯しているときは、エンコーダーと磁石の距離が適切ではありません。（どの距離でも点灯する場合は壊れている可能性があります）

- kicker基盤のLED
  - 赤：コンデンサが充電済みで高電圧状態
  - 黄：コンデンサに充電中
  - 緑：statusLED
    - 1秒間隔で短く点滅 : 正常
    - 0.5秒間隔で短く点滅 : エラー発生中
    - 1秒間隔で長く点滅 : コンデンサ放電中



# 原因＆解決策

## ソフトウェアの問題

### AIとの通信部分がおかしい

ai-serverから動かすときに

- ロボットから　"ピピッ"　という音がならない時
- 基板上のオレンジ色のLEDが回転していない時

上のような場合はAI-serverまたはJetsonに問題があります。

解決策
- Jetson上でnodeが立ち上がっているかを確認します。

  - 立ち上がっていない場合

    - 再起動または以下のコマンドでノードを立ち上げなおします。
    ```
    sudo systemctl restart　kiks_phoenix.service
    ```

  - 立ち上がっている場合
    - jetsonがwifiにつながっていない可能性があります。
    `nmcli`コマンドを使うことで、jetsonのwifiの接続状況を確認することができます。

###  FPGAに正常にプログラムが書き込めていない
- ロボットから　"ピピッ"　という音がなるが、基板上のオレンジ色のLEDが回転していない時
- オレンジ色のLEDがすべて弱く点灯しているとき

解決策
- FPGAに書き込むデータをもう一度確認してください。(ブランチはJetsonと同じものになっていますか？)

# ハードウェアの問題

- モーターが一つだけ回らない
- 一つだけ高速回転する
- ドリブラーが不調
- ロボットが蹴らない

などの問題は、ハードウェアに問題がある可能性が高いです

***
### デバッグの際の注意点
- 必ず電源装置につないでデバッグを行う（lipoを用いると過電流による事故につながります。）
- 回らないモーターが熱くなっていた場合は、モーターに過電流が流れていた可能性があります。
- モーターとチャージを同時に行う場合は、電流制限を5Aに設定しましょう。
***

## モーターが一つだけ回らない


原因としては

- 基板上のICが死亡している
- モーターの線が断線している
- モーターが死んでいる

などが考えられます。

### 実験方法

1. 電源装置で起動し、モーターを動かすときに過電流が流れないことを確認します。

2. 正常に動作するモーターを問題のモーターと交換し正常に動作させてみます。

#### 正常に動作した場合
モーター側に問題があります。
原因としては、
- モーターの断線
- ホールセンサーの異常
- その他、モーターの問題

があげられます

#### 正常に動作しなかった場合

基盤側に問題があります。
原因としては
- ホールセンサーに5Vを供給するICが死亡している
- エンコーダーに問題がある(エンコーダーのケーブルを外すと正常に動作する)
- モータードライバーICが死亡している
- 基盤内断線

などがあげられます。

### 原因特定方法

オシロスコープを用いて、モーターのコネクタにかかっている電圧を確認します。
- GND 5V(ホールセンサー電源)
- ホールセンサー三相
- ＵＶＷ相電圧（48V PWM）

３つのホールセンサーの値が、モーターを回転させたときに変化することを確認して下さい。もし出ていない場合は、モーターケーブルの断線、ホールセンサーの故障などが考えられます。

ＵＶＷ相の電圧が最大48V出ていることを確認してください。
- すべての相が10v程度の場合は、何らかの原因でモーター制御が行われていません。

他の正常なモーターと異常なモーターで、基板上の各点の電圧を測定することで、原因がわかることがあります。

## モーターが一つだけ高速回転する

原因としては
- 基盤が故障している
- エンコーダーが断線している
- エンコーダーが故障している

などがあげられます

### 原因特定方法
- エンコーダーLEDが点灯していないことを確認します。
  - 点灯している場合はエンコーダーと、磁石との距離を調節してください。（調節しても消灯しない場合はエンコーダーICが壊れている可能性があります。）

- エンコーダーのコネクターにかかっている電圧を確認します。
  - GND 5Vが出ていることを確認します。
  - A相、B相がタイヤを回転させるとhighとlowが切り替わることを確認します。

出力が正常に出ていた場合、原因は基板上にあることがわかります。
回路図と各点の電圧を見ながら、どこで問題が発生しているのか特定しましょう。

## ドリブラーが不調

うまくドリブルできない原因としては
- ドリブルバーが固まっていて回らない
- ドリブラーは回るがトルクが出ない
- ドリブルモーターが回らない
などがあげられます。

### ドリブルバーが固まっていて回らない
ドリブラーを分解して、
- ギアに破損がないか
- モーターを固定しているねじは緩んで外れていないか
- モーターは物理的に回るか
を確認してもう一度組み立ててください。
この状態でドリブルをしようとすると、ドリブルモーターに過電流が流れるため、気を付けましょう。

### ドリブルバーのトルクが出ない

ドリブルモーターに接続されているギアのイモネジが緩んでいます。
締め直しましょう。

ギアがプラスチック製の場合は、力の入れすぎに注意してください。

### ドリブルモーターが回らない

基本的にデバッグ方法は、足回りのモーターが回らない時と同じです。
ドリブルモーターにはエンコーダーがないため、原因は若干絞られます。

## ロボットが蹴らない

原因としては
- ソレノイドの故障
- ソレノイドの断線 (よくある)
- ソレノイドが接続できていない
- コンデンサが接続できていない
- キッカー基盤の故障
- キッカー基盤のチャージ不良 (よくある)
- キッカー基盤のエラー（よくある）
- ＣＡＮ通信不良
- 拡張基盤不良
- 可変抵抗調整不足（よくある）
- ボールセンサー断線（よくある）
- ＳＰＩ通信不良
- Jetsonプログラムが動いていない

など、様々な問題があげられます。
わかりやすくするために、キック指令の流れを説明します。


>ＡＩがキック指令を発行する
>
>↓　UDP通信（WiFi経由）
>
>Jetsonが指令を受け取り、そのデータを拡張基盤に流す
>
>↓　SPI通信
>
>拡張基盤がデータを受け取り、ボールセンサーが反応していたら、kicker基盤にキック指令を流す
>
>↓　CAN通信
>
>キッカー基盤がデータを受け取り、各種電圧に異常がなければ、コンデンサに充電されていた電荷をソレノイドに流す。
>
>↓　電流（エナメル線）
>
>キック

## 原因特定方法

### 物理的にソレノイドバーが動くか確認する。
ねじの締めすぎや、バーの反りなどが原因で、
ソレノイドバーが動かなくなることがあります。

ドライバーなどで押してみて、スルスル動くか確認しましょう。

### kicker基盤の赤色LEDが点灯していて、黄色LEDが消灯していることを確認する。

黄色LEDが点灯し続けているときは、チャージが正常にできていません。一度スイッチを切ってディスチャージしてから、再度チャージすると正常にチャージできます。

再チャージも正常に行われない場合は、ソレノイドやコンデンサが短絡している可能性があります。

### kicker基盤の緑色LEDの点滅の間隔を確認する。

赤色LEDが点灯しておらず、緑LEDが0.5秒間隔で点滅している場合は、キッカーエラーが解除できていません。

ロボットを再起動すると治ることが多いです（よくない）

### ボールセンサーが読めているか確認する。
ボールまたは指でボールセンサーを隠したときに、
拡張基板上の白いLEDが消灯することを確認してください。（音の場合あり）

もし、常に点灯しているようだったら、ボールセンサーICが壊れています

一方、常に消灯している場合は、
- ボールセンサーと拡張基盤をつなぐケーブルが断線している
- 赤外線LEDの強さを調節する可変抵抗の調整が甘い
などの原因が考えられます。

### Jetson上でデータが読めているかを確認する。

Jetson上でSPI通信のデータを確認することができます。

>方法は後日書きます（）

SPI通信のデータ構成は
[ここ](https://github.com/kiksworks/phoenix-program/issues/29)
、CAN通信のデータ構成は
[ここ](https://github.com/kiksworks/phoenix-program/issues/28)
で確認できます。

各データが正常に読めているかどうかを確認してみて下さい。

### 片方のキックしか蹴らない

99%ソレノイドの断線です。

1%キッカー基盤の故障です。

### 拡張基板からブザー音がなるかを確認する

SPI通信ができていないと、拡張基盤は起動時音とバッテリー音以外の音を鳴らしません。
そのため、音が鳴らない場合はSPI通信ができていないと考えられます。

### kicker基盤のエラーフラグが下がらない。

キッカー基盤とphoenix基盤をつなぐケーブルが接触不良、または基盤に何らかの異常が起きていることが考えられます。
kickerを取り外して、デバッグ用基盤を用いてデバッグを行います。
#### キッカーデバッグ用基板
下の基盤はキッカーデバッグ用基板です。

使い方は別記します（予定）


# その他問題
## ロボットが起動しない
ロボットが起動しない原因には
- リポと基盤をつなぐケーブルの断線
- スイッチの断線
- 基盤がFault状態に入っている
- 基板上の何かしらのICが死んでいる

などが考えられます。

### 原因特定方法
#### 基盤のにおいを嗅ぐ
もしも異臭がしたら、直ぐに電源装置の電源を切ってください。
また、過電流が流れた時にもすぐに電源を切りましょう。

#### 電源を一度抜き、もう一度起動する 
phoenix基盤は重大なエラーであるFaultが発生するとすべての電源をシャットダウンします、一度電源を抜くまで、スイッチを入れなおしても起動しません。

#### スイッチが正常に動作しているかを確かめる
基盤は正常でもスイッチが断線していたら、電源は入りません。
取り外してチェックを行うか、正常なものと交換してみましょう・

#### 上記のすべてを試しても起動しない場合、基盤にエラーがある可能性が高いです。

Jetsonを抜き、GreenPakにテスト用のプログラムを書き込みます。
>参照 GreenPAKの環境開発構築

#### 基盤のテストポイントのチェック
phoenix基板上には、テスターを当てて電圧を測定するためのテストポイントが存在します。
スイッチを入れて、各ポイントに正常な電圧が供給されているかどうかを確認してください。